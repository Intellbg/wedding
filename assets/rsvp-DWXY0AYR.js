import{O as N,r as p,P as $,c as o,d as t,Q as A,e as d,g as v,R as y,b as h,S as C,w as x,T as M,F as T,f as B,U as I,t as b,o as r}from"./index-Ci2qvXNF.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";const R={id:"rsvp",class:"rsvp-section"},V={class:"rsvp-card"},j={class:"input-wrapper autocomplete-wrapper"},E={key:0,class:"input-helper"},O={key:0,class:"suggestion-list"},P=["onClick"],q={key:0},F={key:1,class:"feedback success"},D={key:2,class:"feedback error"},k="https://api-wedding.usagicli.com/api/",L={__name:"rsvp",setup(H){const n=N({name:"",attendance:"",peopleCount:1}),f=p(!1),l=p([]),i=p(!1),c=p(""),m=p("");let u=!1;function w(){setTimeout(()=>{i.value=!1},200)}$(()=>n.name,async a=>{if(u&&a!==n.name?u=!1:a.trim()||(u=!1),!u)if(a.trim().length>=2)try{const s=await(await fetch(`${k}invitations/autocomplete?name=${encodeURIComponent(a)}`)).json();l.value=Array.isArray(s)?s.map(g=>g.name):[],i.value=!0}catch(e){console.error("Autocomplete error:",e),l.value=[],i.value=!1}else l.value=[],i.value=!1});function S(a){n.name=a,u=!0,l.value=[],i.value=!1}async function _(){try{const a={name:n.name,attendance:n.attendance,peopleCount:n.attendance==="Sí"?n.peopleCount:0},e=await fetch(`${k}rsvp`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),s=await e.json();if(!e.ok)throw console.log(s.non_field_errors),new Error(s.non_field_errors[0]||"Ocurrió un error al confirmar.");console.log(s),c.value=`${s.nombre}, ¡gracias por confirmar la asistencia de ${s.personas_confirmadas} persona${s.personas_confirmadas>1?"s":""}!`,m.value="",Object.assign(n,{name:"",attendance:"",peopleCount:1})}catch(a){m.value=a.message||"No se pudo completar su confirmación. Intente más tarde.",c.value=""}}return(a,e)=>(r(),o("section",R,[e[13]||(e[13]=t("h2",{class:"section-title"},"Confirme su Asistencia",-1)),t("div",V,[t("form",{onSubmit:A(_,["prevent"]),class:"rsvp-form"},[t("label",null,[e[6]||(e[6]=v(" Nombre Completo ")),t("div",j,[y(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>n.name=s),required:"",class:"styled-input",onFocus:e[1]||(e[1]=s=>i.value=l.value.length>0),onBlur:w},null,544),[[C,n.name]]),t("span",{class:"info-icon",onMouseenter:e[2]||(e[2]=s=>f.value=!0),onMouseleave:e[3]||(e[3]=s=>f.value=!1)}," ⓘ ",32),h(M,{name:"fade"},{default:x(()=>[f.value?(r(),o("small",E," Ingrese el primer nombre y apellido tal como aparece en la invitación, sin abreviaciones. ")):d("",!0)]),_:1}),i.value&&l.value.length?(r(),o("ul",O,[(r(!0),o(T,null,B(l.value,(s,g)=>(r(),o("li",{key:g,onClick:J=>S(s)},b(s),9,P))),128))])):d("",!0)])]),t("label",null,[e[8]||(e[8]=v(" ¿Asistirá? ")),y(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>n.attendance=s),required:"",class:"styled-input"},e[7]||(e[7]=[t("option",{value:"Sí"},"Sí",-1),t("option",{value:"No"},"No",-1)]),512),[[I,n.attendance]])]),n.attendance==="Sí"?(r(),o("label",q,[e[9]||(e[9]=v(" Número de personas ")),y(t("input",{type:"number","onUpdate:modelValue":e[5]||(e[5]=s=>n.peopleCount=s),min:"1",required:"",class:"styled-input"},null,512),[[C,n.peopleCount,void 0,{number:!0}]])])):d("",!0),e[10]||(e[10]=t("button",{type:"submit",class:"submit-btn"},"Enviar",-1)),c.value?(r(),o("p",F,b(c.value),1)):d("",!0),m.value?(r(),o("p",D,b(m.value),1)):d("",!0)],32),e[11]||(e[11]=t("p",{class:"rsvp-note"},[v(" Si tiene algún inconveniente al confirmar, por favor "),t("a",{href:"https://wa.me/593991391910",target:"_blank",class:"whatsapp-link"}," contáctenos por WhatsApp ")],-1)),e[12]||(e[12]=t("a",{href:"/",class:"rsvp-note"},"Regresar",-1))])]))}},z=U(L,[["__scopeId","data-v-9c8aaa2b"]]);export{z as default};
